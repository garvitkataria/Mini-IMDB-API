SELECT  PlaylistTrack.PlaylistId,  Playlist_name, TrackName, Composer, AlbumTitle, ArtistName, MediaTypeName, GenreName, Milliseconds, Bytes, TrackPrice 
FROM PlaylistTrack 
INNER JOIN Playlist 
ON PlaylistTrack.PlaylistId = Playlist.PlaylistId 
INNER JOIN (
	SELECT * FROM Track 
	INNER JOIN 
	(SELECT * FROM Album 
		INNER JOIN Artist 
		ON Album.Artist_Id = Artist.ArtistId
	) z 
	ON Track.AlbumId = z.Album_Id 
	INNER JOIN MediaType 
	ON Track.MediaTypeId = MediaType.MediaType_Id 
	INNER JOIN Genre 
	ON Track.GenreId = Genre.Genre_Id) p 
ON PlaylistTrack.TrackId = p.Track_Id;


+----+-------------+---------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+----------------------------------+------+----------+---------------------------------------+
| id | select_type | table         | partitions | type   | possible_keys                                                  | key                      | key_len | ref                              | rows | filtered | Extra                                 |
+----+-------------+---------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+----------------------------------+------+----------+---------------------------------------+
|  1 | SIMPLE      | MediaType     | NULL       | ALL    | PRIMARY                                                        | NULL                     | NULL    | NULL                             |    5 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Genre         | NULL       | ALL    | PRIMARY                                                        | NULL                     | NULL    | NULL                             |   25 |   100.00 | Using join buffer (Block Nested Loop) |
|  1 | SIMPLE      | Track         | NULL       | ref    | PRIMARY,IFK_TrackAlbumId,IFK_TrackGenreId,IFK_TrackMediaTypeId | IFK_TrackGenreId         | 5       | chinook.Genre.Genre_Id           |  139 |    20.00 | Using where                           |
|  1 | SIMPLE      | Album         | NULL       | eq_ref | PRIMARY,IFK_AlbumArtistId                                      | PRIMARY                  | 4       | chinook.Track.AlbumId            |    1 |   100.00 | Using where                           |
|  1 | SIMPLE      | Artist        | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinook.Album.Artist_Id          |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | PlaylistTrack | NULL       | ref    | PRIMARY,IFK_PlaylistTrackTrackId                               | IFK_PlaylistTrackTrackId | 4       | chinook.Track.Track_id           |    2 |   100.00 | Using index                           |
|  1 | SIMPLE      | Playlist      | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinook.PlaylistTrack.PlaylistId |    1 |   100.00 | NULL                                  |
+----+-------------+---------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+----------------------------------+------+----------+---------------------------------------+
Last_query_cost = 22862.134293


+----+-------------+---------------+------------+--------+---------------+---------+---------+----------------------------------------------------+------+----------+----------------------------------------------------+
| id | select_type | table         | partitions | type   | possible_keys | key     | key_len | ref                                                | rows | filtered | Extra                                              |
+----+-------------+---------------+------------+--------+---------------+---------+---------+----------------------------------------------------+------+----------+----------------------------------------------------+
|  1 | SIMPLE      | MediaType     | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL                                               |    5 |   100.00 | NULL                                               |
|  1 | SIMPLE      | Track         | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL                                               | 3483 |    10.00 | Using where; Using join buffer (Block Nested Loop) |
|  1 | SIMPLE      | Genre         | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Track.GenreId                              |    1 |   100.00 | NULL                                               |
|  1 | SIMPLE      | Album         | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Track.AlbumId                              |    1 |   100.00 | Using where                                        |
|  1 | SIMPLE      | Artist        | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Album.Artist_Id                            |    1 |   100.00 | NULL                                               |
|  1 | SIMPLE      | Playlist      | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL                                               |   18 |   100.00 | Using join buffer (Block Nested Loop)              |
|  1 | SIMPLE      | PlaylistTrack | NULL       | eq_ref | PRIMARY       | PRIMARY | 8       | chinook.Playlist.PlaylistId,chinook.Track.Track_id |    1 |   100.00 | Using index                                        |
+----+-------------+---------------+------------+--------+---------------+---------+---------+----------------------------------------------------+------+----------+----------------------------------------------------+
Last_query_cost = 24414.177858 


SELECT * 
FROM(
	SELECT * 
	FROM InvoiceLine 
	INNER JOIN Invoice 
	ON InvoiceLine.InvoiceId = Invoice.Invoice_Id 
	INNER JOIN (
		SELECT * 
		FROM Track 
		INNER JOIN (
			SELECT * 
			FROM Album 
			INNER JOIN Artist 
			ON Album.Artist_Id = Artist.ArtistId
			) z 
		ON Track.AlbumId = z.Album_Id 
		INNER JOIN MediaType 
		ON Track.MediaTypeId = MediaType.MediaType_Id 
		INNER JOIN Genre 
		ON Track.GenreId = Genre.Genre_Id
		)k 
	ON InvoiceLine.TrackId = k.Track_Id)y 
INNER JOIN Customer 
ON y.CustomerId=Customer.Customer_Id;


+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+------------------------------+------+----------+---------------------------------------+
| id | select_type | table       | partitions | type   | possible_keys                                                  | key                      | key_len | ref                          | rows | filtered | Extra                                 |
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+------------------------------+------+----------+---------------------------------------+
|  1 | SIMPLE      | Customer    | NULL       | ALL    | PRIMARY                                                        | NULL                     | NULL    | NULL                         |   59 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Invoice     | NULL       | ref    | PRIMARY,IFK_InvoiceCustomerId                                  | IFK_InvoiceCustomerId    | 4       | chinook.Customer.Customer_Id |    6 |   100.00 | NULL                                  |
|  1 | SIMPLE      | InvoiceLine | NULL       | ref    | IFK_InvoiceLineInvoiceId,IFK_InvoiceLineTrackId                | IFK_InvoiceLineInvoiceId | 4       | chinook.Invoice.invoice_id   |    5 |   100.00 | NULL                                  |
|  1 | SIMPLE      | MediaType   | NULL       | ALL    | PRIMARY                                                        | NULL                     | NULL    | NULL                         |    5 |   100.00 | Using join buffer (Block Nested Loop) |
|  1 | SIMPLE      | Track       | NULL       | eq_ref | PRIMARY,IFK_TrackAlbumId,IFK_TrackGenreId,IFK_TrackMediaTypeId | PRIMARY                  | 4       | chinook.InvoiceLine.TrackId  |    1 |    20.00 | Using where                           |
|  1 | SIMPLE      | Genre       | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinook.Track.GenreId        |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Album       | NULL       | eq_ref | PRIMARY,IFK_AlbumArtistId                                      | PRIMARY                  | 4       | chinook.Track.AlbumId        |    1 |   100.00 | Using where                           |
|  1 | SIMPLE      | Artist      | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinook.Album.Artist_Id      |    1 |   100.00 | NULL                                  |
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+------------------------------+------+----------+---------------------------------------+
Last_query_cost = 12621.373604 


+----+-------------+-------------+------------+--------+---------------+---------+---------+-------------------------------+------+----------+---------------------------------------+
| id | select_type | table       | partitions | type   | possible_keys | key     | key_len | ref                           | rows | filtered | Extra                                 |
+----+-------------+-------------+------------+--------+---------------+---------+---------+-------------------------------+------+----------+---------------------------------------+
|  1 | SIMPLE      | MediaType   | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL                          |    5 |   100.00 | NULL                                  |
|  1 | SIMPLE      | InvoiceLine | NULL       | ALL    | NULL          | NULL    | NULL    | NULL                          | 2240 |   100.00 | Using join buffer (Block Nested Loop) |
|  1 | SIMPLE      | Invoice     | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.InvoiceLine.InvoiceId |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Customer    | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Invoice.CustomerId    |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Track       | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.InvoiceLine.TrackId   |    1 |    10.00 | Using where                           |
|  1 | SIMPLE      | Genre       | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Track.GenreId         |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Album       | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Track.AlbumId         |    1 |   100.00 | Using where                           |
|  1 | SIMPLE      | Artist      | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Album.Artist_Id       |    1 |   100.00 | NULL                                  |
+----+-------------+-------------+------------+--------+---------------+---------+---------+-------------------------------+------+----------+---------------------------------------+
Last_query_cost = 17034.015194



select CustomerId, count(InvoiceId) as NoOfTracks, SUM(UnitPrice) as Bill 
FROM(
	SELECT * 
	FROM InvoiceLine 
	INNER JOIN Invoice 
	ON InvoiceLine.InvoiceId = Invoice.Invoice_Id 
	INNER JOIN (
		SELECT * 
		FROM Track 
		INNER JOIN (
			SELECT * 
			FROM Album 
			INNER JOIN Artist 
			ON Album.Artist_Id = Artist.ArtistId
			) z 
		ON Track.AlbumId = z.Album_Id 
		INNER JOIN MediaType 
		ON Track.MediaTypeId = MediaType.MediaType_Id 
		INNER JOIN Genre 
		ON Track.GenreId = Genre.Genre_Id
		)k 
	ON InvoiceLine.TrackId = k.Track_Id
	)y 
INNER JOIN Customer 
ON y.CustomerId=Customer.Customer_Id 
GROUP BY Customer_Id 
ORDER BY Bill DESC;

+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+-----------------------------------+------+----------+----------------------------------------------------+
| id | select_type | table       | partitions | type   | possible_keys                                                  | key                      | key_len | ref                               | rows | filtered | Extra                                              |
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+-----------------------------------+------+----------+----------------------------------------------------+
|  1 | SIMPLE      | Customer    | NULL       | index  | PRIMARY,IFK_CustomerSupportRepId                               | IFK_CustomerSupportRepId | 5       | NULL                              |   59 |   100.00 | Using index; Using temporary; Using filesort       |
|  1 | SIMPLE      | Invoice     | NULL       | ref    | PRIMARY,IFK_InvoiceCustomerId                                  | IFK_InvoiceCustomerId    | 4       | chinookindex.Customer.Customer_Id |    6 |   100.00 | Using index                                        |
|  1 | SIMPLE      | InvoiceLine | NULL       | ref    | IFK_InvoiceLineInvoiceId,IFK_InvoiceLineTrackId                | IFK_InvoiceLineInvoiceId | 4       | chinookindex.Invoice.Invoice_Id   |    5 |   100.00 | NULL                                               |
|  1 | SIMPLE      | MediaType   | NULL       | index  | PRIMARY                                                        | PRIMARY                  | 4       | NULL                              |    5 |   100.00 | Using index; Using join buffer (Block Nested Loop) |
|  1 | SIMPLE      | Track       | NULL       | eq_ref | PRIMARY,IFK_TrackAlbumId,IFK_TrackGenreId,IFK_TrackMediaTypeId | PRIMARY                  | 4       | chinookindex.InvoiceLine.TrackId  |    1 |    20.00 | Using where                                        |
|  1 | SIMPLE      | Genre       | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinookindex.Track.GenreId        |    1 |   100.00 | Using index                                        |
|  1 | SIMPLE      | Album       | NULL       | eq_ref | PRIMARY,IFK_AlbumArtistId                                      | PRIMARY                  | 4       | chinookindex.Track.AlbumId        |    1 |   100.00 | Using where                                        |
|  1 | SIMPLE      | Artist      | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinookindex.Album.Artist_Id      |    1 |   100.00 | Using index                                        |
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+-----------------------------------+------+----------+----------------------------------------------------+
Last_query_cost = 12251.756327 


+----+-------------+-------------+------------+--------+----------------------------------+---------+---------+-------------------------------+------+----------+----------------------------------------------+
| id | select_type | table       | partitions | type   | possible_keys                    | key     | key_len | ref                           | rows | filtered | Extra                                        |
+----+-------------+-------------+------------+--------+----------------------------------+---------+---------+-------------------------------+------+----------+----------------------------------------------+
|  1 | SIMPLE      | MediaType   | NULL       | index  | PRIMARY                          | PRIMARY | 4       | NULL                          |    5 |   100.00 | Using index; Using temporary; Using filesort |
|  1 | SIMPLE      | InvoiceLine | NULL       | ALL    | NULL                             | NULL    | NULL    | NULL                          | 2240 |   100.00 | Using join buffer (Block Nested Loop)        |
|  1 | SIMPLE      | Invoice     | NULL       | eq_ref | PRIMARY                          | PRIMARY | 4       | chinook.InvoiceLine.InvoiceId |    1 |   100.00 | NULL                                         |
|  1 | SIMPLE      | Customer    | NULL       | eq_ref | PRIMARY,IFK_CustomerSupportRepId | PRIMARY | 4       | chinook.Invoice.CustomerId    |    1 |   100.00 | Using index                                  |
|  1 | SIMPLE      | Track       | NULL       | eq_ref | PRIMARY                          | PRIMARY | 4       | chinook.InvoiceLine.TrackId   |    1 |    10.00 | Using where                                  |
|  1 | SIMPLE      | Genre       | NULL       | eq_ref | PRIMARY                          | PRIMARY | 4       | chinook.Track.GenreId         |    1 |   100.00 | Using index                                  |
|  1 | SIMPLE      | Album       | NULL       | eq_ref | PRIMARY                          | PRIMARY | 4       | chinook.Track.AlbumId         |    1 |   100.00 | Using where                                  |
|  1 | SIMPLE      | Artist      | NULL       | eq_ref | PRIMARY                          | PRIMARY | 4       | chinook.Album.Artist_Id       |    1 |   100.00 | Using index                                  |
+----+-------------+-------------+------------+--------+----------------------------------+---------+---------+-------------------------------+------+----------+----------------------------------------------+
Last_query_cost = 17033.999630 


select TrackId,TrackName,ArtistName,AlbumTitle,Composer,TrackPrice,MediaTypeName,GenreName, count(TrackId) as SoldCopies 
FROM(
	SELECT * 
	FROM InvoiceLine 
	INNER JOIN Invoice 
	ON InvoiceLine.InvoiceId = Invoice.Invoice_Id 
	INNER JOIN (
		SELECT * 
		FROM Track 
		INNER JOIN (
			SELECT * 
			FROM Album 
			INNER JOIN Artist 
			ON Album.Artist_Id = Artist.ArtistId
			) z 
		ON Track.AlbumId = z.Album_Id 
		INNER JOIN MediaType 
		ON Track.MediaTypeId = MediaType.MediaType_Id 
		INNER JOIN Genre 
		ON Track.GenreId = Genre.Genre_Id
		)k 
	ON InvoiceLine.TrackId = k.Track_Id
	)y 
INNER JOIN Customer 
ON y.CustomerId=Customer.Customer_Id 
GROUP BY TrackId 
ORDER BY SoldCopies DESC;
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+-----------------------------------+------+----------+----------------------------------------------+
| id | select_type | table       | partitions | type   | possible_keys                                                  | key                      | key_len | ref                               | rows | filtered | Extra                                        |
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+-----------------------------------+------+----------+----------------------------------------------+
|  1 | SIMPLE      | Customer    | NULL       | index  | PRIMARY                                                        | IFK_CustomerSupportRepId | 5       | NULL                              |   59 |   100.00 | Using index; Using temporary; Using filesort |
|  1 | SIMPLE      | Invoice     | NULL       | ref    | PRIMARY,IFK_InvoiceCustomerId                                  | IFK_InvoiceCustomerId    | 4       | chinookindex.Customer.Customer_Id |    6 |   100.00 | Using index                                  |
|  1 | SIMPLE      | InvoiceLine | NULL       | ref    | IFK_InvoiceLineInvoiceId,IFK_InvoiceLineTrackId                | IFK_InvoiceLineInvoiceId | 4       | chinookindex.Invoice.Invoice_Id   |    5 |   100.00 | NULL                                         |
|  1 | SIMPLE      | MediaType   | NULL       | ALL    | PRIMARY                                                        | NULL                     | NULL    | NULL                              |    5 |   100.00 | Using join buffer (Block Nested Loop)        |
|  1 | SIMPLE      | Track       | NULL       | eq_ref | PRIMARY,IFK_TrackAlbumId,IFK_TrackGenreId,IFK_TrackMediaTypeId | PRIMARY                  | 4       | chinookindex.InvoiceLine.TrackId  |    1 |    20.00 | Using where                                  |
|  1 | SIMPLE      | Genre       | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinookindex.Track.GenreId        |    1 |   100.00 | NULL                                         |
|  1 | SIMPLE      | Album       | NULL       | eq_ref | PRIMARY,IFK_AlbumArtistId                                      | PRIMARY                  | 4       | chinookindex.Track.AlbumId        |    1 |   100.00 | Using where                                  |
|  1 | SIMPLE      | Artist      | NULL       | eq_ref | PRIMARY                                                        | PRIMARY                  | 4       | chinookindex.Album.Artist_Id      |    1 |   100.00 | NULL                                         |
+----+-------------+-------------+------------+--------+----------------------------------------------------------------+--------------------------+---------+-----------------------------------+------+----------+----------------------------------------------+

Last_query_cost = 14251.713602
+----+-------------+-------------+------------+--------+---------------+---------+---------+-------------------------------+------+----------+---------------------------------------+
| id | select_type | table       | partitions | type   | possible_keys | key     | key_len | ref                           | rows | filtered | Extra                                 |
+----+-------------+-------------+------------+--------+---------------+---------+---------+-------------------------------+------+----------+---------------------------------------+
|  1 | SIMPLE      | MediaType   | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL                          |    5 |   100.00 | Using temporary; Using filesort       |
|  1 | SIMPLE      | InvoiceLine | NULL       | ALL    | NULL          | NULL    | NULL    | NULL                          | 2240 |   100.00 | Using join buffer (Block Nested Loop) |
|  1 | SIMPLE      | Invoice     | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.InvoiceLine.InvoiceId |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Customer    | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Invoice.CustomerId    |    1 |   100.00 | Using index                           |
|  1 | SIMPLE      | Track       | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.InvoiceLine.TrackId   |    1 |    10.00 | Using where                           |
|  1 | SIMPLE      | Genre       | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Track.GenreId         |    1 |   100.00 | NULL                                  |
|  1 | SIMPLE      | Album       | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Track.AlbumId         |    1 |   100.00 | Using where                           |
|  1 | SIMPLE      | Artist      | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | chinook.Album.Artist_Id       |    1 |   100.00 | NULL                                  |
+----+-------------+-------------+------------+--------+---------------+---------+---------+-------------------------------+------+----------+---------------------------------------+
Last_query_cost = 19034.015194

